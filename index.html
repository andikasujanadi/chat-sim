<!doctype html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" crossorigin="anonymous"
        href="https://cdn.jsdelivr.net/npm/misans@4.0.0/lib/Normal/MiSans-Medium.min.css" />
    <link rel="stylesheet" crossorigin="anonymous"
        href="https://cdn.jsdelivr.net/npm/misans@4.0.0/lib/Normal/MiSans-Bold.min.css" />
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <script src="./dom-to-image.js"></script>
    <style type="text/tailwindcss">
        #phone{
            font-family: 'misans';
        }
        .button{
            @apply px-3 py-2 font-medium rounded-xl cursor-pointer bg-gray-100 text-black;
        }
        .disabled{
            @apply opacity-50 pointer-events-none;
        }
        .form-input{
            @apply border p-2 rounded-xl outline-none border-neutral-200;
        }
        .chat-bubble{
            @apply border p-4 rounded-2xl font-medium border-neutral-200 max-w-96;
        }
        .self-bubble{
            @apply ms-auto bg-blue-600 text-white;
        }
    </style>
</head>

<body class="flex items-start gap-1 bg-stone-200">
    <div class="h-screen overflow-hidden shrink-0 hidden lg:block">
        <div id="phone-container" class="origin-top-left">
            <div id="phone" class="flex flex-col aspect-9/18 w-[1220px]">
                <div class="bg-blue-100">
                    <div class="h-[21px]"></div>
                    <div class="h-[67px] flex items-center px-[48px] justify-between">
                        <div class="">
                            <div class="text-[32px] font-medium">09:18</div>
                        </div>
                        <div class="flex items-center gap-[2px]">
                            <div class="w-[70px] h-[32px] border border-[3px] rounded-[10px] p-[3px]">
                                <div class="h-full w-full bg-black rounded-[4px]"></div>
                            </div>
                            <div class="h-[12px] w-[3px] rounded-[2px] bg-black"></div>
                        </div>
                    </div>
                </div>
                <div
                    class="text-[56px] bg-blue-100 h-[167px] border-b border-black/10 flex gap-[12px] items-center px-[24px]">
                    <svg xmlns="http://www.w3.org/2000/svg" height="72px" viewBox="0 -960 960 960" width="72px"
                        fill="#1f1f1f">
                        <path
                            d="m300.39-438.48 238.52 239.09-58.34 58.22-339.4-339.4 339.26-338.82 58.92 58.78-238.96 238.96h519v83.17h-519Z" />
                    </svg>
                    <div class="h-[106px] w-[106px] rounded-full overflow-hidden">
                        <img class="h-full w-full object-cover"
                            src="https://cdn-useast1.kapwing.com/static/templates/crying-cat-meme-template-full-719a53dc.webp"
                            alt="" srcset="">
                    </div>
                    <div class="ms-[12px]">Iwan</div>
                    <div class="flex ms-auto">
                        <svg class="ms-0" xmlns="http://www.w3.org/2000/svg" height="72px" viewBox="0 -960 960 960"
                            width="72px" fill="#1f1f1f">
                            <path
                                d="M142.3-141.04q-33.5 0-58.33-25.24-24.84-25.23-24.84-57.94v-511.56q0-32.95 24.84-58.34 24.83-25.4 58.33-25.4h511q33.74 0 58.74 25.4 25 25.39 25 58.34v208l164.39-164.39v424.34L737.04-432.22v208q0 32.71-25 57.94-25 25.24-58.74 25.24h-511Zm0-83.18h511v-511.56h-511v511.56Zm0 0v-511.56 511.56Z" />
                        </svg>
                        <svg class="ms-[64px]" xmlns="http://www.w3.org/2000/svg" height="72px" viewBox="0 -960 960 960"
                            width="72px" fill="#1f1f1f">
                            <path
                                d="M800.84-101.17q-122.37 0-247.15-58T323.33-322.26Q217.74-427.35 159.46-553.19q-58.29-125.85-58.29-247.15 0-25.37 16.68-42.21t41.89-16.84h145.43q24 0 39.68 13.67 15.67 13.68 20.8 37.72l27.8 120.86q1.64 20.71-2.56 37.66-4.19 16.95-15.51 27.4l-102.64 98.99q21.74 38.61 49.33 73.29 27.58 34.67 60.32 65.84 34.31 36.87 70.7 64.33t74.43 48.19l100.74-101.17q12.96-14.52 30.13-19.72 17.18-5.19 35.61-.93l114.13 25.91q23.11 6.83 37.19 23.39 14.07 16.57 14.07 39.96v144.26q0 25.53-16.88 42.05-16.88 16.52-41.67 16.52ZM231.09-598l79.26-76.87-22.4-100.78h-101.6q1.43 39.04 10.78 81.66 9.34 42.62 33.96 95.99ZM605-228.65q36.74 17.43 81.83 28.87 45.08 11.43 88.82 14.43v-.06.06-103.46l-94.52-20.97L605-228.65ZM231.09-598ZM605-228.65Z" />
                        </svg>
                        <svg class="ms-[48px]" xmlns="http://www.w3.org/2000/svg" height="72px" viewBox="0 -960 960 960"
                            width="72px" fill="#1f1f1f">
                            <path
                                d="M480.46-119.67q-30.46 0-51.13-21.01-20.66-21.01-20.66-50.52 0-29.43 20.61-51.28 20.6-21.85 50.26-21.85 30.46 0 51.13 21.78 20.66 21.78 20.66 51.16 0 29.39-20.56 50.56-20.55 21.16-50.31 21.16Zm0-289q-30.46 0-51.13-20.61-20.66-20.6-20.66-50.26 0-30.46 20.61-51.13 20.6-20.66 50.26-20.66 30.46 0 51.13 20.56 20.66 20.55 20.66 50.31 0 30.46-20.56 51.13-20.55 20.66-50.31 20.66Zm0-287q-30.46 0-51.13-21.49-20.66-21.49-20.66-51.66 0-30.18 20.61-51.18 20.6-21 50.26-21 30.46 0 51.13 21.06 20.66 21.05 20.66 51.02 0 30.38-20.56 51.82-20.55 21.43-50.31 21.43Z" />
                        </svg>
                    </div>
                </div>
                <div class="flex-grow bg-white">
                    yeah
                </div>
                <div class="h-[48px] w-full bg-black flex items-center justify-center">
                    <div class="h-[12px] w-[456px] bg-white rounded-full"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="output" class="h-screen hidden"></div>
    <div class="p-4 grow h-screen flex  gap-4">
        <div class="flex flex-col bg-white p-4 rounded-2xl h-full grow gap-4">
            <div class="flex gap-4 items-center">
                <div class="h-9 w-9 rounded-full overflow-hidden">
                    <img class="h-full w-full object-cover"
                        src="https://cdn-useast1.kapwing.com/static/templates/crying-cat-meme-template-full-719a53dc.webp"
                        alt="" srcset="">
                </div>
                <div class="text-2xl font-medium">Iwan</div>
            </div>
            <div id="chat-container" style="scrollbar-width:thin;scrollbar-color: #adadad transparent;"
                class="grow flex flex-col gap-2 items-start overflow-auto">

            </div>
            <div class="flex gap-2 items-end">
                <textarea id="text-input" class="form-input grow" rows="3"
                    placeholder="Type your message..."></textarea>
                <div class="flex flex-col gap-2">
                    <div onclick="addChat(0)" class="button">Send</div>
                    <div onclick="addChat()" class="button !bg-blue-600 !text-white">Send</div>
                </div>
            </div>
        </div>
        <div class="flex flex-col h-full gap-4">
            <div class="bg-white rounded-2xl flex flex-col items-center p-4 gap-2">
                <div class="h-20 w-20 rounded-full overflow-hidden">
                    <img class="h-full w-full object-cover"
                        src="https://cdn-useast1.kapwing.com/static/templates/crying-cat-meme-template-full-719a53dc.webp"
                        alt="" srcset="">
                </div>
                <div class="text-lg font-medium">Iwan</div>
                <div class="flex gap-2">
                    <button class="button">
                        Edit Photo
                    </button>
                    <button class="button">
                        Edit Name
                    </button>
                </div>
            </div>
            <div class="bg-white rounded-2xl flex flex-col p-4 gap-2 disabled">
                <div class="font-medium">Members</div>
                <div class="flex gap-2 items-center">
                    <div class="h-8 w-8 rounded-full overflow-hidden">
                        <img class="h-full w-full object-cover"
                            src="https://cdn-useast1.kapwing.com/static/templates/crying-cat-meme-template-full-719a53dc.webp"
                            alt="" srcset="">
                    </div>
                    <div class="font-medium">Iwan</div>
                </div>
                <button class="button">
                    Add
                </button>
            </div>
            <div class="bg-white rounded-2xl flex flex-col p-4 gap-2 grow">
                <div class="font-medium">Action and Stuff</div>
                <button onclick="downloadChat()" class="button">
                    Download Chat as Image
                </button>
            </div>
        </div>
    </div>
    <script>
        const deleteIcon = `
        <svg  xmlns="http://www.w3.org/2000/svg"  width="20"  height="20"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-trash"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7l16 0" /><path d="M10 11l0 6" /><path d="M14 11l0 6" /><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" /><path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" /></svg>
        `;
        const moveIcon = `
        <svg  xmlns="http://www.w3.org/2000/svg"  width="20"  height="20"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-arrows-left-right"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M21 17l-18 0" /><path d="M6 10l-3 -3l3 -3" /><path d="M3 7l18 0" /><path d="M18 20l3 -3l-3 -3" /></svg>
        `;
        const upIcon = `
        <svg  xmlns="http://www.w3.org/2000/svg"  width="20"  height="20"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M18 11l-6 -6" /><path d="M6 11l6 -6" /></svg>
        `;
        const downIcon = `
        <svg  xmlns="http://www.w3.org/2000/svg"  width="20"  height="20"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-down"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M18 13l-6 6" /><path d="M6 13l6 6" /></svg>
        `;
        const persons = ['Iwan', 'iklabib'];
        const chats = [
            [0, 'yeah?'],
            [-1, 'oh yeah'],
            [0, 'yeah!!'],
            [-1, 'Lorem ipsum dolor sit amet consectetur adipisicing elit.'],
        ];

        function addChat(from = -1) {
            const textInput = document.getElementById('text-input');
            const message = textInput.value.trim();
            if (!message) return;

            chats.push([from, message]);
            textInput.value = '';
            renderChat();
        }

        function deleteChat(index) {
            chats.splice(index, 1);
            renderChat();
        }

        function renderChat() {
            const container = document.getElementById('chat-container');
            container.innerHTML = '';

            chats.forEach(([sender, message], index) => {
            const chatBubble = document.createElement('div');
            chatBubble.className = `chat-bubble ${sender === -1 ? 'self-bubble' : ''}`;
            
            const messageText = document.createElement('span');
            messageText.textContent = message;

            const tempDivDelete = document.createElement('span');
            tempDivDelete.innerHTML = deleteIcon;
            const deleteSvgIcon = tempDivDelete.firstElementChild;
            const deleteBtn = document.createElement('span');
            deleteBtn.className = 'cursor-pointer p-1 rounded-lg border bg-neutral-100 text-black border-neutral-300';
            deleteBtn.appendChild(deleteSvgIcon);
            deleteBtn.onclick = () => deleteChat(index);

            const tempDivMove = document.createElement('span');
            tempDivMove.innerHTML = moveIcon;
            const moveSvgIcon = tempDivMove.firstElementChild;
            const moveBtn = document.createElement('span');
            moveBtn.className = 'cursor-pointer p-1 rounded-lg border bg-neutral-100 text-black border-neutral-300';
            moveBtn.appendChild(moveSvgIcon);
            moveBtn.onclick = () => {
                chats[index][0] = sender === -1 ? 0 : -1;
                renderChat();
            };

            const tempDivUp = document.createElement('span');
            tempDivUp.innerHTML = upIcon;
            const upSvgIcon = tempDivUp.firstElementChild;
            const upBtn = document.createElement('span');
            upBtn.className = 'cursor-pointer p-1 rounded-lg border bg-neutral-100 text-black border-neutral-300';
            upBtn.appendChild(upSvgIcon);
            upBtn.onclick = () => {
                if (index > 0) {
                    [chats[index], chats[index - 1]] = [chats[index - 1], chats[index]];
                    renderChat();
                }
            };

            const tempDivDown = document.createElement('span');
            tempDivDown.innerHTML = downIcon;
            const downSvgIcon = tempDivDown.firstElementChild;
            const downBtn = document.createElement('span');
            downBtn.className = 'cursor-pointer p-1 rounded-lg border bg-neutral-100 text-black border-neutral-300';
            downBtn.appendChild(downSvgIcon);
            downBtn.onclick = () => {
                if (index < chats.length - 1) {
                    [chats[index], chats[index + 1]] = [chats[index + 1], chats[index]];
                    renderChat();
                }
            };

            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'flex justify-end mt-2 gap-1';
            buttonContainer.appendChild(upBtn);
            buttonContainer.appendChild(downBtn);
            buttonContainer.appendChild(moveBtn);
            buttonContainer.appendChild(deleteBtn);

            chatBubble.appendChild(messageText);
            chatBubble.appendChild(buttonContainer);
            container.appendChild(chatBubble);
        });
        }

        renderChat();


        function downloadBase64Image(base64String, filename = "chat.png") {
            const byteCharacters = atob(base64String.split(',')[1]);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            const blob = new Blob([byteArray], { type: 'image/png' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function downloadChat() {
            var node = document.getElementById('phone');
            domtoimage.toPng(node)
                .then(function (dataUrl) {
                    var img = new Image();
                    var imgElement;
                    img.src = dataUrl;
                    const outputContainer = document.getElementById('output');
                    outputContainer.innerHTML = '';
                    outputContainer.appendChild(img);
                    imgElement = outputContainer.querySelector('img');
                    imgElement.classList.add('h-screen');
                    downloadBase64Image(dataUrl);
                })
                .catch(function (error) {
                    console.error('oops, something went wrong!', error);
                });
        }
        function resizePhone() {
            const phoneContainer = document.getElementById('phone-container');
            let phoneHeight = document.getElementById('phone').offsetHeight;
            let phoneWidth = document.getElementById('phone').offsetWidth;
            let windowHeight = window.innerHeight;
            let windowWidth = window.innerHeight;
            let heightRatio = window.innerHeight / phoneHeight;
            let widthRatio = phoneWidth * heightRatio;
            phoneContainer.style.transform = `scale(${heightRatio})`;
            phoneContainer.style.width = widthRatio + "px";
        }
        resizePhone();

        function debounce(func, delay) {
            let timer;
            return function () {
                clearTimeout(timer);
                timer = setTimeout(func, delay);
            };
        }
        window.addEventListener("resize", debounce(resizePhone, 100));
    </script>
</body>

</html>